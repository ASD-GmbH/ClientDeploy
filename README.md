# ClientDeploy

A set of tools for providing software installation and update facilities for use in closed environments - i.e. in-house.

## Components

### ClientDeployHost standalone http Server

 * Requires .net core 2.0
 * dotnet ClientDeployHost.dll http://192.168.0.22:8082 httprepo
 * httprepo must point to a valid repository folder structure

 * Repository structure:
  - top level: JSON file named '.clientdeployrepo.config' with the following content: { "Key" : "" } where key is empty at the moment
  - top level: a clientdeploy.zip file with the following content: ~/updater/0.0.0/... where 0.0.0 is the current ClientDeployUpdateProcess (CDUP) version and ... are all files required for CDUP
  - top level: folders for product channel including one mandatory "ClientDeployUpdateProcess".
  - channel folders - JSON file named '.config' with the following content: { "Name" : "ClientDeployUpdateProcess", "Displayname" : "ClientDeploy Updater", "Description" : "Internal" }
  - channel folders - folders for product versions
  - version folder: JSON file named ".version" with the following content:  { "Version" : "0.2.0", "Deprecated" : false, "ReleaseNotes" : "ClientDeploy Update Process" }
  - version folder: all files required for installing the product
  - Caveat: at this time, the server needs to be restarted in order to detect changes in the repository


### ClientDeploy dll (nuget)

 * Requires .net 4.5
 * Provides Updater class to check for updates at start time or peridically. The caller is informed about updates becoming available and needs to call Update.
 * In the background, the Updater always provides for the newest CDUP version.


### Standalone installer (setup.exe)

 * Requires .net 4.5
 * call with three arguments: repo product targetfolder
 * setup will download the current ClientDeployUPdateProcess and instruct that to install the requested product

## Changes
 ### vNext
 - Reload button on repository homepage to refresh cached repository information

## Roadmap

 ### Log install/update steps to local file
 Currently, there is only output to the stdout stream. Observing the output requires a console window, which disappears shortly after update (3 second delay) and takes the log info with it.
 - Introduce a "--log somewhere/myfile.log" command line option
 - Log output of the process appending to the log file
 - Remove the arbitrary 3 second delays in ClientDeployUpdateProcess/Program.fs

 ### Rollback on install/update error
 If the update fails, the installation is currently left in an unstable state.
 Every InstallerAction step should either include an UndoStep or generate an UpdoStep upon execution. If an exception occurrs during a step, the UndoSteps of preceeding steps should be executed in reverse order to roll back the failed installation.

 ### build script
 There is no build script yet.
 - Make a build script
 - generate a nuget package for the ClientDeploy.dll
 - prepare a zip file with the server and a ready-to-run repository

 ### Basic functionality tests
 Once there is a build script, it would be desireable to have smoke tests for all modules' basic functionality. Those should be run as part of the build.

 ### Support subfolders in repository
 Currently, a repository may only consist of flat files. The scanFiles function should recursively consider files within subfolders as resources.

 ### Support manually defined Installer Expectations in .manifest file in version folder
 Currently, the manifest is generated by scanning a repository folder with a .version config file. It should be possible to include a .manifest file with at least the following functionality:
 - Specify include/exclude patterns for scanning files into resources
 - Specify ExpectFolder requirements
 - Specify ExpectConfigurationFile requirements
 - Specify ExpectRegistryKey requirements
 - Specify ExpectProcessRuns requirements
 - Specify ExpectExactFile requirements using files in external resource packs

 ### InstallerExpectation for Windows registry keys
 needs to be implemented in ClientDeployUpdateProcess/Installer.fs

 ### InstallerExpectation for local templated files
 needs to be implemented in ClientDeployUpdateProcess/Installer.fs

 ### InstallerExpectation for running the software immediately after installation
 needs to be implemented in ClientDeployUpdateProcess/Installer.fs

 ### move .clientdeploy.config from specialcasing to InstallerExpectation/templated file
 clientdeploy.dll expects the .clientdeploy.config file to be present and hold information about the repository url, product channel and installed version. Currently, this file is created by ClientDeployUpdateProcess explicitly and only if the product channel is not ClientDeployUpdateProcess. Instead, the file should be an installation expectation using the ExpectConfigurationFile directive, using to-be-provided Manifest.PathPlaceholder placeholders for (uuid,repository,channel,version).

 ### GUI info dispenser during update
 Add a simple windows forms progress bar possibly with detail info which can be configured by a new command line option, e.g. "--progresswindow"

 ### Zip resources in bundles for faster delivery and better caching

 ### Cache resource bundles on clients

 ### Allow Clients to connect to a local zip file in lieu of the http repository for offline installation and update

 ### ClientDeployUpdateProcess will collect Metadata and report on updatelevel of client deployments.


